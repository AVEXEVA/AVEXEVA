<?PHP
NAMESPACE SQL;
CLASS DATABASE EXTENDS \SQL\INDEX {
  //VARIABLES
  ///LINKS
  PROTECTED $RESOURCE     = NULL;
  ///ARGUMENTS
  PROTECTED $ID           = NULL;
  PROTECTED $DATASERVER   = NULL;
  PROTECTED $USER         = NULL;
  PROTECTED $IP           = NULL;
  PROTECTED $NAME         = NULL;
  ///CHILDREN
  PROTECTED $DATATABLES   = ARRAY();
  //FUNCTIONS
  ///MAGIC
  PUBLIC FUNCTION __CONSTRUCT( $_ARGS = NULL ){
    PARENT::__CONSTRUCT( $_ARGS );
    SELF::__CONNECT( );
  }
  PRIVATE FUNCTION __CONNECT( ){
    SELF::__RESOURCE( );
    SELF::__TABLES( );
  }
  //CONSTRUCTORS
  PRIVATE FUNCTION __RESOURCE(){
    PARENT::__SET( 
      'RESOURCE',
      NEW \SQL\RESOURCE( ARRAY ( 
        'DATABASE' => $THIS,
        'TYPE' => 'DEFAULT'
      ) )
    );
  }
  PRIVATE FUNCTION __TABLE( $TABLE = NULL ){ RETURN NEW \SQL\TABLE ( $TABLE ); }
  PRIVATE FUNCTION __TABLES( ){
    SWITCH( PARENT::__GET( 'RESOURCE' )->__GET( 'TYPE' ) ){
      CASE 'SQLSRV' : SELF::__TABLES_SQLSRV( ); BREAK;
      CASE 'MYSQLI' : SELF::__TABLES_MYSQLI( ); BREAK;
      DEFAULT       : SELF::__TABLES_MYSLQI( ); BREAK;
    }
  }
  PRIVATE FUNCTION __TABLES_SQLSRV( ){ }
  PRIVATE FUNCTION __TABLES_MYSQLI( ){
    $TABLES = ARRAY();
    $QUERY = "SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE COLUMNS.TABLE_CATALOG = ?;";
    $STATEMENT = MYSQLI_PREPARE( 
      PARENT::__GET( 'RESOURCE' )->__GET( 'LINK' ),
      $QUERY
    );
    MYSQLI_STMT_BIND_PARAM(
      $STATEMENT,
      'I',
      PARENT::__GET( 'NAME' )
    );
    MYSQLI_STMT_EXECUTE( $STATEMENT );
    $RESULT = MYSQLI_STMT_GET_RESULT( $STATEMENT );
    IF( $QUERY ){WHILE( $ROW = MYSQLI_FETCH_ROW( $RESULT )){ $TABLES[] = SELF::__TABLE( $ROW ); }}
    PARENT::__SET( 'TABLES', $TABLES );
  }
  //CHECK_TABLE
  PRIVATE FUNCTION __CHECK_TABLE( $TABLE = NULL ){
    IF( !IS_STRING( $TABLE ) ){ RETURN FALSE; }
    $QUERY = "SELECT COUNT( * ) AS COUNT FROM INFORMATION_SCHEMA.TABLES WHERE TABLES.TABLE_NAME = ? GROUP BY TABLES.TABLE_NAME;";
    $STATEMENT = MYSQLI_PREPARE(
      PARENT::__GET( 'RESOURCE' )->__GET( 'LINK' ),
      $QUERY
    );
    MYSQLI_STMT_BIND_PARAM( 
      $STATEMENT,
      'I',
      $TABLE
    );
    MYSQLI_STMT_EXECUTE( $STATEMENT );
    $RESULT = MYSQLI_STMT_GET_RESULT( $STATEMENT );
    IF( $QUERY ){ RETURN MYSQLI_FETCH_ROW( $RESULT )[ 'COUNT' ] > 0; }
    RETURN FALSE;
  }
  //TRANSLATORS
  PRIVATE FUNCTION __DATA_IN( $DATA_IN = NULL ){
    IF( SELF::__CHECK_TABLE( ) )
  }
}?>